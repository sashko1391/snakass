<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snakass: The Game</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #222;
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            user-select: none; /* –©–æ–± —Ç–µ–∫—Å—Ç –Ω–µ –≤–∏–¥—ñ–ª—è–≤—Å—è –ø—Ä–∏ –≥—Ä—ñ */
        }

        h1 {
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #2ecc71;
            text-shadow: 2px 2px #000;
        }

        .score-board {
            font-size: 24px;
            margin-bottom: 15px;
            color: #f1c40f;
            font-weight: bold;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–∞–Ω–≤–∞—Å—É */
        canvas {
            border: 4px solid #555;
            background-color: #000; /* –ö–æ–ª—ñ—Ä, –ø–æ–∫–∏ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è —Ñ–æ–Ω */
            background-size: cover; /* –§–æ–Ω —Ä–æ–∑—Ç—è–≥—É—î—Ç—å—Å—è –Ω–∞ –≤—Å–µ –ø–æ–ª–µ */
            background-position: center;
            box-shadow: 0 0 30px rgba(0,0,0,0.7);
            image-rendering: pixelated; /* –©–æ–± –ø—ñ–∫—Å–µ–ª—å–Ω—ñ —Ç–µ–º–∏ –±—É–ª–∏ —á—ñ—Ç–∫–∏–º–∏ */
        }

        .controls {
            margin-top: 20px;
            background: #333;
            padding: 15px 25px;
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
            border: 1px solid #444;
        }

        label {
            font-size: 16px;
            color: #ccc;
        }

        select {
            padding: 8px;
            font-size: 16px;
            border-radius: 5px;
            border: none;
            background: #fff;
            cursor: pointer;
            outline: none;
        }

        button {
            padding: 8px 20px;
            font-size: 16px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background-color: #c0392b;
        }

        .hint {
            margin-top: 10px;
            font-size: 12px;
            color: #777;
        }
    </style>
</head>
<body>

    <h1>Snakass üêç</h1>
    <div class="score-board">–†–∞—Ö—É–Ω–æ–∫: <span id="scoreVal">0</span></div>
    
    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <div class="controls">
        <label for="themeSelector">–û–±–µ—Ä–∏ —Ç–µ–º—É:</label>
        <select id="themeSelector">
            </select>
        <button onclick="resetGame()">–†–µ—Å—Ç–∞—Ä—Ç</button>
    </div>
    <div class="hint">–ö–µ—Ä—É–≤–∞–Ω–Ω—è: –°—Ç—Ä—ñ–ª–∫–∏ –Ω–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—ñ</div>

<script>
// ==========================================
// –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –¢–ï–ú (–†–ï–î–ê–ì–£–í–ê–¢–ò –¢–£–¢)
// ==========================================
const availableThemes = [
    // ext: 'jpg' –∞–±–æ 'png'. –Ø–∫—â–æ –Ω–µ –≤–∫–∞–∑–∞–Ω–æ - –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 'jpg'
    { id: 'standard', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ (JPG)', ext: 'jpg' },
    { id: 'pixel',    name: 'Pixel Art (PNG)',  ext: 'png' },
    { id: 'dark',     name: 'Dark Mode',        ext: 'jpg' }
];

// ==========================================
// –õ–û–ì–Ü–ö–ê –ì–†–ò
// ==========================================

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("scoreVal");
const themeSelector = document.getElementById('themeSelector');

const gridSize = 20; 
const tileCount = canvas.width / gridSize;

let score = 0;
let dx = 0; dy = 0;
let snake = [];
let food = {x: 5, y: 5};
let gameInterval;

// –û–±'—î–∫—Ç–∏ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫
const assets = {
    head: new Image(),
    body: new Image(),
    food: new Image()
};

// --- 1. –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø –°–ü–ò–°–ö–£ –¢–ï–ú ---
availableThemes.forEach(theme => {
    const option = document.createElement('option');
    option.value = theme.id;
    option.innerText = theme.name;
    themeSelector.appendChild(option);
});

// --- 2. –§–£–ù–ö–¶–Ü–Ø –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –¢–ï–ú–ò ---
function loadTheme(themeId) {
    const themeConf = availableThemes.find(t => t.id === themeId);
    if (!themeConf) return;

    const ext = themeConf.ext || 'jpg'; // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º jpg
    const path = `./themes/${themeId}/`;

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ñ–æ–Ω —á–µ—Ä–µ–∑ CSS
    canvas.style.backgroundImage = `url('${path}bg.${ext}')`;

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —à–ª—è—Ö–∏ –¥–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫
    assets.head.src = `${path}head.${ext}`;
    assets.body.src = `${path}body.${ext}`;
    assets.food.src = `${path}food.${ext}`;

    // –ó–Ω—ñ–º–∞—î–º–æ —Ñ–æ–∫—É—Å –∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞, —â–æ–± —Å—Ç—Ä—ñ–ª–∫–∏ –∫–µ—Ä—É–≤–∞–ª–∏ –∑–º—ñ–π–∫–æ—é, –∞ –Ω–µ —Å–ø–∏—Å–∫–æ–º
    themeSelector.blur();
    canvas.focus();
}

// –°–ª—É—Ö–∞—á –∑–º—ñ–Ω–∏ —Ç–µ–º–∏
themeSelector.addEventListener('change', (e) => {
    loadTheme(e.target.value);
});

// --- 3. –Ü–ì–†–û–í–ò–ô –¶–ò–ö–õ ---
function startGame() {
    snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
    dx = 1; dy = 0; // –ü–æ—á–∏–Ω–∞—î–º–æ —Ä—É—Ö –≤–ø—Ä–∞–≤–æ
    score = 0;
    scoreEl.innerText = score;
    createFood();
    
    if (gameInterval) clearInterval(gameInterval);
    gameInterval = setInterval(gameLoop, 100); // –®–≤–∏–¥–∫—ñ—Å—Ç—å –≥—Ä–∏ (100–º—Å)
}

function gameLoop() {
    if (didGameEnd()) {
        alert("–ì—Ä—É –∑–∞–∫—ñ–Ω—á–µ–Ω–æ! –¢–≤—ñ–π —Ä–∞—Ö—É–Ω–æ–∫: " + score);
        startGame();
        return;
    }

    clearCanvas();
    drawFood();
    moveSnake();
    drawSnake();
}

function clearCanvas() {
    // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–æ—Ç–Ω–æ, —Ä–æ–±–ª—è—á–∏ –π–æ–≥–æ –ø—Ä–æ–∑–æ—Ä–∏–º, —â–æ–± –±—É–ª–æ –≤–∏–¥–Ω–æ bg.jpg
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function drawSnake() {
    snake.forEach((part, index) => {
        const isHead = index === 0;
        const img = isHead ? assets.head : assets.body;
        
        // –ú–∞–ª—é—î–º–æ –∫–∞—Ä—Ç–∏–Ω–∫—É, —è–∫—â–æ –≤–æ–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞
        if (img.complete && img.naturalHeight !== 0) {
            ctx.drawImage(img, part.x * gridSize, part.y * gridSize, gridSize, gridSize);
        } else {
            // –§–æ–ª–±–µ–∫ (–∑–∞–ø–∞—Å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç): –ø—Ä–æ—Å—Ç–æ –∫–æ–ª—å–æ—Ä–æ–≤—ñ –∫–≤–∞–¥—Ä–∞—Ç–∏
            ctx.fillStyle = isHead ? '#2ecc71' : '#27ae60';
            ctx.fillRect(part.x * gridSize, part.y * gridSize, gridSize - 2, gridSize - 2);
            
            // –ú–∞–ª—é—î–º–æ –æ—á—ñ –¥–ª—è –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ—ó –∑–º—ñ—ó
            if (isHead) {
                ctx.fillStyle = 'black';
                ctx.fillRect(part.x*gridSize+4, part.y*gridSize+4, 4, 4);
                ctx.fillRect(part.x*gridSize+12, part.y*gridSize+4, 4, 4);
            }
        }
    });
}

function drawFood() {
    if (assets.food.complete && assets.food.naturalHeight !== 0) {
        ctx.drawImage(assets.food, food.x * gridSize, food.y * gridSize, gridSize, gridSize);
    } else {
        // –§–æ–ª–±–µ–∫ –¥–ª—è —ó–∂—ñ
        ctx.fillStyle = '#e74c3c';
        ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 2, gridSize - 2);
    }
}

function moveSnake() {
    const head = {x: snake[0].x + dx, y: snake[0].y + dy};
    snake.unshift(head);

    if (head.x === food.x && head.y === food.y) {
        score++;
        scoreEl.innerText = score;
        createFood();
    } else {
        snake.pop();
    }
}

function createFood() {
    food.x = Math.floor(Math.random() * tileCount);
    food.y = Math.floor(Math.random() * tileCount);
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ–± —ó–∂–∞ –Ω–µ —Å–ø–∞–≤–Ω–∏–ª–∞—Å—å –Ω–∞ —Ç—ñ–ª—ñ
    snake.forEach(part => {
        if (part.x === food.x && part.y === food.y) createFood();
    });
}

function didGameEnd() {
    // –í–∫—É—Å —Å–µ–±–µ
    for (let i = 4; i < snake.length; i++) {
        if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) return true;
    }
    // –°—Ç—ñ–Ω–∏
    const hitLeft = snake[0].x < 0;
    const hitRight = snake[0].x >= tileCount;
    const hitTop = snake[0].y < 0;
    const hitBottom = snake[0].y >= tileCount;
    
    return hitLeft || hitRight || hitTop || hitBottom;
}

function resetGame() {
    startGame();
    themeSelector.blur();
}

// –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–æ—é
document.addEventListener("keydown", changeDirection);

function changeDirection(event) {
    const LEFT = 37, RIGHT = 39, UP = 38, DOWN = 40;
    const key = event.keyCode;

    // –ë–ª–æ–∫—É—î–º–æ —Å–∫—Ä–æ–ª —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø—Ä–∏ –≥—Ä—ñ
    if([37, 38, 39, 40].indexOf(key) > -1) {
        event.preventDefault();
    }

    if (key === LEFT && dx !== 1) { dx = -1; dy = 0; }
    if (key === UP && dy !== 1) { dx = 0; dy = -1; }
    if (key === RIGHT && dx !== -1) { dx = 1; dy = 0; }
    if (key === DOWN && dy !== -1) { dx = 0; dy = 1; }
}

// –°—Ç–∞—Ä—Ç
loadTheme(availableThemes[0].id); // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–µ—Ä—à—É —Ç–µ–º—É
startGame();

</script>
</body>
</html>
